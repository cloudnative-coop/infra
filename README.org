#+title: infra

#+begin_quote
a Flux + Terraform infrastructure repo
#+end_quote

* Todo

- [ ] add Flux for cloudnative-coop repo
- [ ] get talosconfig
- [ ] access Kubernetes APIServer

* Prerequisites

Install OpenTofu

#+begin_src shell
brew install opentofu
#+end_src

* Usage

plan

#+begin_src shell
tofu destroy -var equinix_metal_project_id=$METAL_PROJECT_ID -var equinix_metal_auth_token=$METAL_AUTH_TOKEN
#+end_src

apply

#+begin_src shell
tofu apply -var equinix_metal_project_id=REPLACE_PROJECT_ID_HERE
#+end_src

get talosconfig

#+begin_src shell :results silent
tofu output -raw talosconfig > ~/.talos/config-cloudnative-coop
#+end_src

get kubeconfig

#+begin_src shell :results silent
tofu output -raw kubeconfig > ~/.kube/config-cloudnative-coop
#+end_src
